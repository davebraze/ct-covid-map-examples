---
title: "CT COVID Map: Variations"
author: David Braze

output: 
  flexdashboard::flex_dashboard:
    theme: yeti
    orientation: columns
    vertical_layout: fill
---

```{css echo=FALSE}

h3  {
	font-size: 100px;
}

```

```{r setup, include=FALSE}

library(flexdashboard)
library(ggplot2)
library(FDBpub)

theme_set(FDBpub::theme_fdbplot(base_size=10))

theme_update(axis.line = element_blank(),
             axis.text = element_blank(),
             axis.ticks = element_blank(),
             panel.grid = element_blank(),
             panel.border = element_blank())

knitr::opts_chunk$set(fig.width=7,
                      fig.height=7/(16/9),
                      fig.align = "center", ## horz center figs on page
                      out.width="95%",
                      out.height="95%", 
                      dpi=if(doc_type()=="pdf") 300 else 200,
                      dev=if(doc_type()=="pdf") "cairo_pdf" else "png", 
                      dev.args=if(doc_type()=="pdf") NULL else list(type="cairo-png"),
                      echo=FALSE,
                      message=FALSE,
                      warning=FALSE,
                      include=TRUE,
                      results='asis',
                      cache=FALSE,
                      cache.lazy=FALSE)

```

```{r workhorse, include=FALSE}

source(here::here("ct-covid-map.R"))

```

# GGplot

## Column {data-width=750}

### **GGplot**
	
```{r ggplot}

map.positivity

```

## Column {data-width=250}

### **Notes** 

This is a non-interactive map built with basic ggplot2 functions. 

I am using a shapefile-based set of multipolygons for the town outlines. These are probably higher resolution than needed. It might be possible to reduce size (and load time) of the dashboard if I switched to the lower resolution geojson-based polygons that I'm using with leaflet.

# GGplotly

## Column {data-width=750}

### **GGplotly**
	
```{r ggplotly}

map.positivity.ggplotly

```

## Column {data-width=250}

### **Notes** 

This is a plotly interactive map created by submitting the previous ggplot2 map to the plotly::ggplotly() function. 

I don't care for how the tooltips only deploy when the mouse approaches the center of a town/polygon. It should pop up when the mouse is over any part of a town.

# Plot_ly

## Column {data-width=750}
 
### **Plot_ly** 

```{r plotly}

map.positivity.plotly

```

## Column {data-width=250}

### **Notes**

Interactive choropleth via plotly::plot_ly(). 

I'm using  a geojson-based set of polygons for town outlines in this map. Plot_ly() gets the aspect ratio wrong if using the shapefile-based set of multipolygons that I used with ggplot() and ggplotly() maps. I'm not sure why.

# Leaflet

## Column {data-width=750}

### **Leaflet** 

`r paste("10 Day Average Covid-19 Test Positivity in Connecticut Towns\nfor period ending", format(max(ct.covid$Date), "%B %d, %Y"))`

```{r leaflet}

map.positivity.leaflet

```

## Column {data-width=250}

### **Notes**

Interactive choropleth via leaflet::leaflet(). 

Previous plots in this series used multipolygon shapes for towns taken from conventional shape files. I couldn't get that to work with leaflet and so switched to simple polygons. These were read from geojson files, but I think the crucial difference is multipolygon vs. somple polygons. 

I don't know why the colorscale in the legend is inverted. Needs to be fixed.

Leaflet maps don't provide a "title" feature, as such. Here, I've just added the title text above the map. Could use some basic formatting.

# About

## Column {data-width=33}

### About the Maps

Covid data for these figures was compiled by CT Dept. of Public Health through `r format(max(ct.covid$Date), "%b %d, %Y")` and accessed through https://data.ct.gov/stories/s/COVID-19-data/wa3g-tfvc/#data-library.

Figures were created by David Braze (davebraze@gmail.com) using R statistical software and released under the Creative Commons v4.0 CC-by license.

## Column {data-width=33}

### About the Author

David Braze is a researcher and consultant with a background in linguistics and reading research. He has more than 25 years experience investigating the cognitive foundations of language, literacy, and educational achievement, including 17 years as a Senior Research Scientist at [Haskins Laboratories](https://haskinslabs.org/). His research at Haskins, funded by the National Institutes of Health, emphasized the neurobiology of language and reading and applications to education. Dr. Braze consults widely for business, government, and non-profit sectors. 

|   email: davebraze@gmail.com
|   website: [davebraze.org](https://davebraze.org/ "D. Braze's website")


## Column {data-width=33}

### About the Software

All data summaries in this dashboard were produced with the _R_ statistical environment, version `r paste(version$major, version$minor, sep=".")`. The dashboard itself was made using an Rmarkdown workflow. The following table lists the non-base R packages used in building the dashboard. To see a full citation for a specific package, assuming you have both _R_ and the particular package installed, call (e.g.) `citation("dplyr")` from the _R_ prompt. 

```{r r-package-tab, include=TRUE}

package_tab <-
    sessioninfo::package_info() %>%
    unclass() %>%
    as_tibble() %>%
    filter(attached == TRUE) %>%
    select(package, ondiskversion, date) %>%
    rename(version = ondiskversion)
caption <- "R packages used in this dashboard."
package_tab %>%
    FDBpub::format_table(caption=caption, out_type=doc_type())

```
